document.addEventListener("DOMContentLoaded",e=>{const t=document.documentElement.clientWidth;let s=45,a=0,n="";const i=document.querySelector("#hamburger"),c=document.querySelector("#chatInput"),l=document.querySelector("#chatArea"),o=document.querySelectorAll("#chatBtn"),d=document.querySelector("#loader"),r=io("https://stark-lake-56522.herokuapp.com/"),m=document.querySelector(".header"),h=document.querySelector(".sidebar__items"),g=document.querySelectorAll(".header__icon-img"),v=document.querySelectorAll(".sidebar__item-title"),u=document.querySelectorAll(".sidebar__item-icon"),_=document.querySelector(".fade__page"),y=document.querySelector("body"),f=document.querySelector(".chat__tabs");function p(e){return e<10?"0"+e:e}function b(){axios.post("https://stark-lake-56522.herokuapp.com/decodejwt",{token:localStorage.getItem("token")}).then((function(e){var t;n=e.data.login,t=e.data.login,axios.post("https://stark-lake-56522.herokuapp.com/renderRecentMessages",{login:t+"chats"}).then((function(e){let t;e.data.messages.reverse(),t=e.data.messages.length>=200?200:e.data.messages.length;for(let s=t-1;s>=0;s--){const t=e.data.messages[s],a=p(new Date(t.date).getHours()),n=p(new Date(t.date).getMinutes()),i=p(new Date(t.date).getMonth()+1),c=`${p(new Date(t.date).getDate())}.${i}`,l=`${a}:${n}`;I(t.sender,c,l,t.message)}d.classList.toggle("hide"),l.scrollBy(0,l.scrollHeight)})).catch((function(e){alert(e)})),r.on("chat message",(async function(e){const t=p(new Date(e.date).getHours()),s=p(new Date(e.date).getMinutes()),a=p(new Date(e.date).getMonth()+1),n=`${p(new Date(e.date).getDate())}.${a}`,i=`${t}:${s}`;await I(e.sender,n,i,e.message),l.scrollBy(0,l.scrollHeight)})),r.emit("chat message",{message:"systemConnectionCheckBIBA",login:n})})).catch((function(e){location.href="../signup/index.html"}))}async function I(e,t,s,a){if("admin"===e){let n=document.createElement("div");n.setAttribute("class","messageItem"),n.classList.add("adminItem"),n.innerHTML=`\n        \n        <div class="messageItem__container-admin">\n            <div class="messageItem__avatar">\n                <img class="messageItem__avatar-img admin__img" src="../img/chat/admin.svg" alt="">\n            </div>\n            <div class="messageItem__content">\n                <div class="messageItem__info">\n                    <div class="messageItem__name">${e}</div>\n                    <div class="messageItem__date">${t}</div>\n                </div>\n                <div class="messageItem__text">${a}</div>\n            </div>\n            <div class="messageItem__hours">${s}</div>\n        </div>\n        `,l.append(n),n=""}else{let n=document.createElement("div");n.setAttribute("class","messageItem"),n.innerHTML=`\n        \n        <div class="messageItem__container">\n            <div class="messageItem__avatar">\n                <img class="messageItem__avatar-img" src="../img/chat/profile.svg" alt="">\n            </div>\n            <div class="messageItem__content">\n                <div class="messageItem__info">\n                    <div class="messageItem__name">${e}</div>\n                    <div class="messageItem__date">${t}</div>\n                </div>\n                <div class="messageItem__text">${a}</div>\n            </div>\n            <div class="messageItem__hours">${s}</div>\n        </div>\n        `,l.append(n),n=""}}axios.post("https://stark-lake-56522.herokuapp.com/checkjwt",{token:localStorage.getItem("token")}).then((function(e){if(e.data.message)location.href="../signin/index.html";else{document.querySelector("#bgOut").classList.add("hide"),b()}})).catch((function(e){alert(e)})),document.querySelectorAll("#active__sidebar").forEach(e=>{"3"===e.getAttribute("number")&&(e.innerHTML="{ Чат }",e.style.fontWeight="700",e.style.color="#fff")}),i.addEventListener("click",e=>{i.classList.toggle("open-menu"),i.classList.contains("open-menu")?function(){let e=65;_.style.display="block",window.screen.width<=768&&(y.style.overflow="hidden");const t=setInterval(()=>{80==e&&_.classList.add("show__fadePage"),260===e?clearInterval(t):(e+=15,h.style.width=e+"px"),245===e&&(v.forEach(e=>{e.style.display="block"}),u.forEach(e=>{e.style.marginRight="20"}))},20)}():function(){let e=260;_.classList.remove("show__fadePage"),_.style.display="none",y.style.overflow="unset",v.forEach(e=>{e.style.display="none"}),u.forEach(e=>{e.style.marginRight="0"});const t=setInterval(()=>{65===e?clearInterval(t):(e-=15,h.style.width=e+"px")},20)}()}),window.addEventListener("scroll",e=>{pageYOffset>=50?(m.classList.add("header__inmove"),g.forEach(e=>{e.classList.add("header__inmoveicon")})):(m.classList.remove("header__inmove"),g.forEach(e=>{e.classList.remove("header__inmoveicon")}))}),function(){for(let e=0;e<5;e++)f.innerHTML+='\n          \n              <div class="chat__tabs-item">\n                  <div class="chat__tabs-itemText">Шакал</div>\n                  <img src="../img/chat/hashtag-2.png" class="chat__tabs-itemImg">\n              </div>\n          ';const e=document.querySelectorAll(".chat__tabs-item"),t=document.querySelectorAll(".chat__tabs-itemImg");e.forEach((e,s)=>{0==s&&(e.classList.add("active__tab"),t[0].classList.add("active__tab-img")),e.style.cssText="\n          margin-right: 10px;\n          "})}(),function(){const e=document.querySelectorAll(".chat__tabs-item"),t=document.querySelectorAll(".chat__tabs-itemImg");e.forEach((s,a)=>{s.addEventListener("click",()=>{e.forEach(e=>{e.classList.remove("active__tab")}),t.forEach(e=>{e.classList.remove("active__tab-img")}),s.classList.add("active__tab"),t[a].classList.add("active__tab-img")})})}(),autosize(c),c.addEventListener("input",e=>{if(s<+c.style.height.slice(0,-2)&&a<=6&&(a+=1,s=+c.style.height.slice(0,-2),l.style.minHeight=l.clientHeight-23+15+"px",l.style.height=l.clientHeight-23+15+"px"),s>+c.style.height.slice(0,-2)&&(s-=23,a-=1,l.style.minHeight=l.clientHeight+23+15+"px"),45==+c.style.height.slice(0,-2)){switch(t){case 375:l.style.height="55vh",l.style.minHeight="55vh";break;case 414:l.style.height="50vh",l.style.minHeight="50vh";break;default:l.style.height="70vh",l.style.minHeight="70vh"}s=45,a=0}}),o.forEach(e=>{e.addEventListener("click",e=>{if(c.value)switch(r.emit("chat message",{message:c.value.replaceAll("\n","<br>"),login:n}),console.log(c.value),c.value="",c.style.height="45px",t){case 375:l.style.height="55vh",l.style.minHeight="55vh";break;case 414:l.style.height="50vh",l.style.minHeight="50vh";break;default:l.style.height="70vh",l.style.minHeight="70vh"}})}),document.addEventListener("keydown",e=>{"Enter"!==e.code||e.shiftKey?"Enter"===e.code&&e.shiftKey:(e.preventDefault(),c.value&&(r.emit("chat message",{message:c.value.replaceAll("\n","<br>"),login:n}),c.value="",c.style.height="45px",l.style.height="70vh",e.preventDefault()))})});