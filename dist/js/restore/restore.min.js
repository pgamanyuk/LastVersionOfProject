document.addEventListener("DOMContentLoaded",e=>{const t=document.querySelector("#mail"),s=document.querySelector("#restoreBtn"),r=document.querySelector("#restorePasswordBlock"),o=document.querySelector("#confirmPasswordBlock"),a=document.querySelector("#createNewPasswordBlock"),i=document.querySelector("#confirmPasswordInput"),l=document.querySelector("#restoreText"),n=document.querySelector("#errorConfirmMessage"),d=document.querySelector("#pass"),c=document.querySelector("#confirmPass"),u=document.querySelector("#passError"),h=document.querySelector("#passMatchError"),v=document.querySelector("#btnSend"),L=document.querySelector("#sendCounter"),g=document.querySelector("#btnCounter__send"),m=document.querySelectorAll("#passIcon");let p="",b=t.value;function y(e){return e<10?"0"+e:e}function f(){let e=10;L.innerHTML=`Отправить повторно через ${y(e)} секунд`;const t=setInterval(()=>{0===e&&(clearInterval(t),L.classList.toggle("hide"),g.classList.toggle("hide")),e-=1,L.innerHTML=`Отправить повторно через ${y(e)} секунд`},1e3)}function E(){i.value.length<6&&n.classList.add("hide"),6===i.value.length&&(i.value===p?(o.classList.toggle("hide"),a.classList.toggle("hide"),function(e){v.addEventListener("click",t=>{t.preventDefault();const s=d.value;axios.post("http://localhost:8000/createNewPassword",{mail:e,password:s}).then(e=>{location.href="../signin/index.html"})})}(b)):n.classList.remove("hide"))}g.addEventListener("click",e=>{e.preventDefault(),g.classList.toggle("hide"),L.classList.toggle("hide"),i.removeEventListener("input",E),f(),axios.post("http://localhost:8000/restorePassword",{mail:b}).then(e=>{p=e.data.restoreCode,i.addEventListener("input",E)})}),m.forEach((e,t)=>{e.addEventListener("click",()=>{e.classList.toggle("icon-hide"),0===t?(m[1].classList.toggle("icon-hide"),d.setAttribute("type","text"),c.setAttribute("type","text")):(m[0].classList.toggle("icon-hide"),d.setAttribute("type","password"),c.setAttribute("type","password"))})}),d.addEventListener("blur",()=>{/(?=.*[0-9])(?=.*[A-Z])[0-9a-zA-Z]{8,}/g.test(d.value)||u.classList.remove("hide")},!0),d.addEventListener("focus",()=>{u.classList.add("hide")},!0),d.addEventListener("input",()=>{u.classList.contains("hide")&&h.classList.contains("hide")&&d.value&&d.value===c.value?v.removeAttribute("disabled"):v.setAttribute("disabled","disabled")}),c.addEventListener("blur",()=>{d.value!==c.value&&h.classList.remove("hide")},!0),c.addEventListener("focus",()=>{h.classList.add("hide")},!0),c.addEventListener("input",()=>{u.classList.contains("hide")&&h.classList.contains("hide")&&d.value&&d.value===c.value?v.removeAttribute("disabled"):v.setAttribute("disabled","disabled")}),t.addEventListener("input",e=>{t.value.length>0?s.removeAttribute("disabled"):s.setAttribute("disabled","disabled")}),s.addEventListener("click",e=>{e.preventDefault(),b=t.value,axios.post("http://localhost:8000/restorePassword",{mail:b}).then(e=>{if(e.data.message)errorMessage.innerHTML=e.data.message,errorMessage.classList.toggle("hide"),setTimeout(()=>{errorMessage.classList.toggle("hide")},4e3);else{let t,s=!1,a=[];for(let e=b.length-1;e>=0;e--)"@"!==b[e]?s&&t>0?(t-=1,a.push("*")):a.push(b[e]):(a.push(b[e]),s=!0,t=Math.floor(e/2));r.classList.toggle("hide"),l.innerHTML=`Мы отправили письмо с кодом на почту ${a.reverse().join("")}  Введи его:`,o.classList.toggle("hide"),f(),p=e.data.restoreCode,i.addEventListener("input",E)}}).catch(e=>{console.log(e)})})});